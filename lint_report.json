
> cookievoting@0.0.0 lint
> eslint . --format json

[{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\.storybook\\firebase-decorator.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":13,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":13,"endColumn":64,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\.storybook\\main.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\.storybook\\preview.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\.storybook\\vitest.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\config\\jest.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\config\\jest.setup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\config\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\config\\test-setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\config\\vitest.shims.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\functions\\src\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\clear-emulator-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\debug-firestore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\detect-all-images.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\export-emulator-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\fetch-prod-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\import-emulator-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\seed-emulator-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\set-admin.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":26,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import admin from 'firebase-admin';\r\nimport { createRequire } from 'module';\r\n\r\nconst require = createRequire(import.meta.url);\r\n\r\nif (process.argv.length < 3) {\r\n  console.error('Usage: node scripts/set-admin.js <email_or_uid>');\r\n  process.exit(1);\r\n}\r\n\r\nconst targetUser = process.argv[2];\r\n\r\n// Initialize Firebase Admin\r\nif (!admin.apps.length) {\r\n  try {\r\n    // Try to load service account first for explicit project ID\r\n    // This is robust against \"Unable to detect a Project Id\" errors\r\n    const serviceAccount = require('../service-account.json');\r\n    console.log(`Found service account for project: ${serviceAccount.project_id}`);\r\n\r\n    admin.initializeApp({\r\n      credential: admin.credential.cert(serviceAccount),\r\n      projectId: serviceAccount.project_id\r\n    });\r\n    console.log('Initialized with service-account.json');\r\n  } catch (e) {\r\n    console.warn('Could not load ../service-account.json, trying default credentials...');\r\n    try {\r\n      admin.initializeApp();\r\n    } catch (e2) {\r\n      console.error('Failed to initialize firebase-admin:', e2.message);\r\n      process.exit(1);\r\n    }\r\n  }\r\n}\r\n\r\nasync function setAdminRole(userInput) {\r\n  try {\r\n    let user;\r\n    // Check if input looks like an email\r\n    if (userInput.includes('@')) {\r\n      user = await admin.auth().getUserByEmail(userInput);\r\n    } else {\r\n      user = await admin.auth().getUser(userInput);\r\n    }\r\n\r\n    if (!user) {\r\n      console.error(`User ${userInput} not found.`);\r\n      process.exit(1);\r\n    }\r\n\r\n    console.log(`Setting admin claim for user: ${user.email} (${user.uid})`);\r\n\r\n    // Set custom user claims\r\n    await admin.auth().setCustomUserClaims(user.uid, { admin: true });\r\n\r\n    // Refresh user to verify (optional, mostly for display)\r\n    const updatedUser = await admin.auth().getUser(user.uid);\r\n    console.log(`Successfully set admin claim.`);\r\n    console.log(`Current claims:`, updatedUser.customClaims);\r\n    console.log(`\\nNOTE: The user may need to sign out and sign back in (or refresh the page) for this to take effect.`);\r\n\r\n  } catch (error) {\r\n    console.error('Error setting admin role:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nsetAdminRole(targetUser);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\setup-firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\scripts\\start-emulators.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\atoms\\AlertModal\\AlertModal.stories.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\atoms\\AlertModal\\AlertModal.tsx","messages":[{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":68,"column":13,"nodeType":"JSXOpeningElement","endLine":74,"endColumn":14},{"ruleId":"jsx-a11y/no-noninteractive-element-interactions","severity":1,"message":"Non-interactive elements should not be assigned mouse or keyboard event listeners.","line":68,"column":13,"nodeType":"JSXOpeningElement","endLine":74,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import styles from './AlertModal.module.css';\r\n\r\n/**\r\n * Props for the AlertModal component\r\n */\r\ninterface AlertModalProps {\r\n    /** The message to display in the modal */\r\n    message: string;\r\n    /** The type of alert, determines styling and default title */\r\n    type?: 'success' | 'error' | 'info';\r\n    /** Callback function called when the modal is closed */\r\n    onClose: () => void;\r\n    /** Optional custom title. If not provided, a default title is used based on type */\r\n    title?: string;\r\n}\r\n\r\n/**\r\n * AlertModal - A modal component for displaying alert messages to users.\r\n * \r\n * This component displays a modal overlay with a message, title, and close button.\r\n * It supports different alert types (success, error, info) which determine the\r\n * styling and default title. The modal can be closed by clicking the OK button\r\n * or clicking outside the modal (on the overlay).\r\n * \r\n * @example\r\n * ```tsx\r\n * <AlertModal\r\n *   message=\"Operation completed successfully!\"\r\n *   type=\"success\"\r\n *   onClose={() => setIsOpen(false)}\r\n * />\r\n * ```\r\n * \r\n * @param props - Component props\r\n * @returns JSX element containing the modal\r\n */\r\nexport function AlertModal({ message, type = 'info', onClose, title }: AlertModalProps) {\r\n    const getTitle = () => {\r\n        if (title) return title;\r\n        switch (type) {\r\n            case 'success':\r\n                return 'Success';\r\n            case 'error':\r\n                return 'Error';\r\n            default:\r\n                return 'Information';\r\n        }\r\n    };\r\n\r\n    const handleOverlayKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n            e.preventDefault();\r\n            onClose();\r\n        } else if (e.key === 'Escape') {\r\n            onClose();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div \r\n            className={styles.modalOverlay} \r\n            onClick={onClose}\r\n            onKeyDown={handleOverlayKeyDown}\r\n            role=\"button\"\r\n            tabIndex={0}\r\n            aria-label=\"Close modal\"\r\n        >\r\n            <div \r\n                className={styles.modal} \r\n                onClick={(e) => e.stopPropagation()}\r\n                role=\"dialog\"\r\n                aria-modal=\"true\"\r\n                aria-labelledby=\"alert-modal-title\"\r\n            >\r\n                <h3 \r\n                    id=\"alert-modal-title\"\r\n                    className={styles[`title${type.charAt(0).toUpperCase() + type.slice(1)}`]}\r\n                >\r\n                    {getTitle()}\r\n                </h3>\r\n                <p className={styles.message}>{message}</p>\r\n                <div className={styles.modalActions}>\r\n                    <button \r\n                        onClick={onClose} \r\n                        className={styles.modalButton}\r\n                    >\r\n                        OK\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\atoms\\AuthButton\\AuthButton.stories.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\atoms\\AuthButton\\AuthButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\layout\\Layout.stories.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\layout\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\CookieViewer\\CookieViewer.stories.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\CookieViewer\\CookieViewer.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":126,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":126,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\BakerSetupStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\CategoryNamingStep.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":35,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., &quot;Sugar Cookie\", \"Chocolate Chip\")"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., &ldquo;Sugar Cookie\", \"Chocolate Chip\")"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., &#34;Sugar Cookie\", \"Chocolate Chip\")"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., &rdquo;Sugar Cookie\", \"Chocolate Chip\")"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":35,"column":93,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie&quot;, \"Chocolate Chip\")"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie&ldquo;, \"Chocolate Chip\")"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie&#34;, \"Chocolate Chip\")"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie&rdquo;, \"Chocolate Chip\")"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":35,"column":96,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", &quot;Chocolate Chip\")"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", &ldquo;Chocolate Chip\")"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", &#34;Chocolate Chip\")"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", &rdquo;Chocolate Chip\")"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":35,"column":111,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", \"Chocolate Chip&quot;)"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", \"Chocolate Chip&ldquo;)"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", \"Chocolate Chip&#34;)"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[950,1022],"text":"Give each image a category name (e.g., \"Sugar Cookie\", \"Chocolate Chip&rdquo;)"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useEffect } from 'react';\r\nimport styles from './EventSetupWizard.module.css';\r\nimport { type UploadedImage } from './ImageUploadStep';\r\n\r\ninterface Props {\r\n  images: UploadedImage[];\r\n  uploading: boolean;\r\n  onNameChange: (index: number, name: string) => void;\r\n  onCreateCategories: () => Promise<void>;\r\n  onBack: () => void;\r\n  onNext: () => void;\r\n  hasExistingCategories: boolean;\r\n  error?: string | null;\r\n}\r\n\r\nexport function CategoryNamingStep({\r\n  images,\r\n  uploading,\r\n  onNameChange,\r\n  onCreateCategories,\r\n  onBack,\r\n  onNext,\r\n  hasExistingCategories,\r\n  error\r\n}: Props) {\r\n  const categoryInputRefs = useRef<(HTMLInputElement | null)[]>([]);\r\n\r\n  useEffect(() => {\r\n    categoryInputRefs.current = categoryInputRefs.current.slice(0, images.length);\r\n  }, [images.length]);\r\n\r\n  return (\r\n    <div className={styles.stepContent}>\r\n      <h2>Name Each Category</h2>\r\n      <p className={styles.instruction}>Give each image a category name (e.g., \"Sugar Cookie\", \"Chocolate Chip\")</p>\r\n\r\n      <div className={styles.categoryNameGrid}>\r\n        {images.map((img, index) => {\r\n          const imageKey = img.name || img.preview || `image-${index}`;\r\n          const uniqueKey = `category-${imageKey.slice(-50)}-${index}`;\r\n          return (\r\n            <div key={uniqueKey} className={styles.categoryNameCard}>\r\n              <img src={img.preview} alt={`Category ${index + 1}`} />\r\n              <input\r\n                ref={(el) => { categoryInputRefs.current[index] = el; }}\r\n                type=\"text\"\r\n                placeholder={`Category ${index + 1} name`}\r\n                value={img.categoryName || ''}\r\n                onChange={(e) => onNameChange(index, e.target.value)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    const nextIndex = index + 1;\r\n                    if (nextIndex < images.length && categoryInputRefs.current[nextIndex]) {\r\n                      categoryInputRefs.current[nextIndex]?.focus();\r\n                    }\r\n                  }\r\n                }}\r\n                className={styles.input}\r\n                maxLength={100}\r\n              />\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {error && <div className={styles.error}>{error}</div>}\r\n\r\n      <div className={styles.actions}>\r\n        <button onClick={onBack} className={styles.buttonSecondary} disabled={uploading}>\r\n          ← Back\r\n        </button>\r\n        {hasExistingCategories && (\r\n          <button\r\n            onClick={onNext}\r\n            className={styles.buttonSecondary}\r\n            disabled={uploading}\r\n          >\r\n            Next: Add Bakers →\r\n          </button>\r\n        )}\r\n        <button\r\n          onClick={onCreateCategories}\r\n          disabled={uploading || images.some(img => !img.categoryName?.trim())}\r\n          className={styles.buttonPrimary}\r\n        >\r\n          {uploading ? 'Creating...' : hasExistingCategories ? 'Add More Categories' : 'Create Categories'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\CookieTaggingStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentBaker' is defined but never used. Allowed unused args must match /^_/u.","line":37,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":46,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'bounds' is defined but never used. Allowed unused args must match /^_/u.","line":203,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":203,"endColumn":66},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":206,"column":17,"nodeType":"JSXOpeningElement","endLine":224,"endColumn":18},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":206,"column":17,"nodeType":"JSXOpeningElement","endLine":224,"endColumn":18}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useEffect } from 'react';\r\nimport { type Category, type CookieCoordinate } from '../../../lib/types';\r\nimport { CookieViewer, type DetectedCookie } from '../CookieViewer/CookieViewer';\r\nimport { calculateSmartLabelPositions, calculateBoundsFromCookie } from '../../../lib/labelPositioning';\r\nimport styles from './EventSetupWizard.module.css';\r\n\r\ninterface Baker {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\ninterface Props {\r\n  currentCategory: Category;\r\n  categories: Category[];\r\n  currentCategoryIndex: number;\r\n  onCategoryChange: (index: number) => void;\r\n  bakers: Baker[];\r\n  currentBaker: Baker | null;\r\n  taggedCookies: Record<string, Record<string, CookieCoordinate[]>>;\r\n  detectedCookies: DetectedCookie[];\r\n  loadingDetection: boolean;\r\n  onCookieTag: (cookie: DetectedCookie, bakerId: string) => void;\r\n  onCookieRemove: (cookie: CookieCoordinate) => void;\r\n  onAutoDetect: () => Promise<void>;\r\n  onComplete: () => void;\r\n  categoryCompletion: Record<string, boolean>;\r\n  error?: string | null;\r\n  detecting?: boolean;\r\n}\r\n\r\nexport function CookieTaggingStep({\r\n  currentCategory,\r\n  categories,\r\n  currentCategoryIndex,\r\n  onCategoryChange,\r\n  bakers,\r\n  currentBaker,\r\n  taggedCookies,\r\n  detectedCookies,\r\n  loadingDetection,\r\n  onCookieTag,\r\n  onCookieRemove,\r\n  onAutoDetect,\r\n  onComplete,\r\n  categoryCompletion,\r\n  error,\r\n  detecting\r\n}: Props) {\r\n  const imageContainerRef = useRef<HTMLDivElement>(null);\r\n  const [showBakerSelect, setShowBakerSelect] = React.useState(false);\r\n  const [selectedDetectedCookie, setSelectedDetectedCookie] = React.useState<DetectedCookie | null>(null);\r\n  const [bakerSelectPosition, setBakerSelectPosition] = React.useState<{ x: number, y: number } | null>(null);\r\n\r\n  // Close baker selection when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      if (showBakerSelect && imageContainerRef.current && !imageContainerRef.current.contains(e.target as Node)) {\r\n        setShowBakerSelect(false);\r\n        setSelectedDetectedCookie(null);\r\n        setBakerSelectPosition(null);\r\n      }\r\n    };\r\n\r\n    if (showBakerSelect) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      return () => {\r\n        document.removeEventListener('mousedown', handleClickOutside);\r\n      };\r\n    }\r\n  }, [showBakerSelect]);\r\n\r\n  const handlePolygonClick = (e: React.MouseEvent, cookie: DetectedCookie) => {\r\n    setSelectedDetectedCookie(cookie);\r\n    setBakerSelectPosition({ x: e.clientX, y: e.clientY });\r\n    setShowBakerSelect(true);\r\n  };\r\n\r\n  const handleBakerSelect = (bakerId: string) => {\r\n    if (selectedDetectedCookie) {\r\n      onCookieTag(selectedDetectedCookie, bakerId);\r\n    }\r\n    setShowBakerSelect(false);\r\n    setSelectedDetectedCookie(null);\r\n    setBakerSelectPosition(null);\r\n  };\r\n\r\n  // Helper to extract file identifier from URL\r\n  const generateDetectedCookieId = (imageUrl: string, cookie: { x: number; y: number }): string => {\r\n    const extractFileName = (url: string): string => {\r\n      try {\r\n        const uuidMatch = url.match(/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/i);\r\n        if (uuidMatch) return uuidMatch[1];\r\n        const urlObj = new URL(url.split('?')[0]);\r\n        const pathParts = urlObj.pathname.split('/');\r\n        return pathParts[pathParts.length - 1].split('.')[0];\r\n      } catch {\r\n        return url;\r\n      }\r\n    };\r\n    const fileId = extractFileName(imageUrl);\r\n    const x = Math.round(cookie.x * 10) / 10;\r\n    const y = Math.round(cookie.y * 10) / 10;\r\n    return `detected_${fileId}_${x}_${y}`;\r\n  };\r\n\r\n  return (\r\n    <div className={styles.stepContent}>\r\n      <div className={styles.categoryNavigation}>\r\n        <button\r\n          onClick={() => onCategoryChange(Math.max(0, currentCategoryIndex - 1))}\r\n          disabled={currentCategoryIndex === 0}\r\n          className={styles.navButton}\r\n        >\r\n          ← Previous\r\n        </button>\r\n        <div className={styles.categoryTitle}>\r\n          <h3>{currentCategory.name}</h3>\r\n          <div className={styles.progressBar}>\r\n            {categories.map((cat, idx) => {\r\n              const isComplete = categoryCompletion[cat.id] === true;\r\n              return (\r\n                <button\r\n                  type=\"button\"\r\n                  key={cat.id}\r\n                  className={`${styles.progressDot} ${idx === currentCategoryIndex ? styles.active : ''} ${isComplete ? styles.tagged : ''}`}\r\n                  title={cat.name}\r\n                  onClick={() => onCategoryChange(idx)}\r\n                  aria-label={`Go to category: ${cat.name}`}\r\n                  style={{ background: 'none', border: 'none', padding: 0, cursor: 'pointer' }}\r\n                />\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n        <button\r\n          onClick={() => onCategoryChange(Math.min(categories.length - 1, currentCategoryIndex + 1))}\r\n          disabled={currentCategoryIndex === categories.length - 1}\r\n          className={styles.navButton}\r\n        >\r\n          Next →\r\n        </button>\r\n      </div>\r\n\r\n      <div className={styles.taggingWorkspace}>\r\n        <div className={styles.imageContainer} ref={imageContainerRef}>\r\n          {loadingDetection && (\r\n            <div style={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', color: 'white', zIndex: 20 }}>\r\n              Loading detection...\r\n            </div>\r\n          )}\r\n          \r\n          <CookieViewer\r\n            imageUrl={currentCategory.imageUrl}\r\n            detectedCookies={detectedCookies}\r\n            onCookieClick={(cookie, _, e) => {\r\n              const allTaggedForCategory = Object.values(taggedCookies[currentCategory.id] || {}).flat();\r\n              const cookieId = cookie.id || generateDetectedCookieId(currentCategory.imageUrl, cookie);\r\n              const isTagged = allTaggedForCategory.some(tagged => {\r\n                if (tagged.detectedCookieId === cookieId) return true;\r\n                if (tagged.detectedCookieId) return false;\r\n                const distance = Math.sqrt(Math.pow(tagged.x - cookie.x, 2) + Math.pow(tagged.y - cookie.y, 2));\r\n                return distance < 6;\r\n              });\r\n\r\n              if (isTagged) {\r\n                setSelectedDetectedCookie(cookie);\r\n                setBakerSelectPosition({ x: e.clientX, y: e.clientY });\r\n                setShowBakerSelect(true);\r\n              } else {\r\n                handlePolygonClick(e, cookie);\r\n              }\r\n            }}\r\n            className={styles.taggingImage}\r\n            borderColor=\"transparent\"\r\n          />\r\n\r\n          {/* Render markers for tagged cookies with smart label positions */}\r\n          {(() => {\r\n            const categoryCookies: Array<{ cookie: CookieCoordinate; baker: Baker | undefined }> = [];\r\n            Object.entries(taggedCookies[currentCategory.id] || {}).forEach(([bakerId, cookies]) => {\r\n              const baker = bakers.find(b => b.id === bakerId);\r\n              cookies.forEach(cookie => categoryCookies.push({ cookie, baker }));\r\n            });\r\n\r\n            // Sort top-to-bottom, left-to-right\r\n            const sortedCookies = categoryCookies.sort((a, b) => {\r\n              const yDiff = a.cookie.y - b.cookie.y;\r\n              if (Math.abs(yDiff) < 15) return a.cookie.x - b.cookie.x;\r\n              return yDiff;\r\n            });\r\n\r\n            const cookiesWithBounds = sortedCookies.map(({ cookie, baker }) => {\r\n              const matchingDetected = detectedCookies.find(d => {\r\n                const distance = Math.sqrt(Math.pow(d.x - cookie.x, 2) + Math.pow(d.y - cookie.y, 2));\r\n                return distance < 5;\r\n              });\r\n              const bounds = calculateBoundsFromCookie(cookie, matchingDetected || null);\r\n              return { cookie, baker, bounds };\r\n            });\r\n\r\n            const labelPositions = calculateSmartLabelPositions(cookiesWithBounds);\r\n\r\n            return cookiesWithBounds.map(({ cookie, baker, bounds }, index) => {\r\n              const labelPos = labelPositions[index];\r\n              return (\r\n                <div\r\n                  key={cookie.id}\r\n                  className={styles.cookieMarker}\r\n                  style={{\r\n                    left: `${cookie.x}%`,\r\n                    top: `${cookie.y}%`,\r\n                    transform: 'translate(-50%, -50%)',\r\n                    backgroundColor: 'rgba(59, 130, 246, 0.8)',\r\n                    border: '2px solid white'\r\n                  }}\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    const matchingDetected = detectedCookies.find(d => {\r\n                      const distance = Math.sqrt(Math.pow(d.x - cookie.x, 2) + Math.pow(d.y - cookie.y, 2));\r\n                      return distance < 6;\r\n                    });\r\n                    if (matchingDetected) handlePolygonClick(e, matchingDetected);\r\n                  }}\r\n                >\r\n                  <span className={styles.cookieNumber}>{index + 1}</span>\r\n                  <div \r\n                    className={`${styles.cookieLabel} ${styles[labelPos]}`}\r\n                    style={{ whiteSpace: 'nowrap' }}\r\n                  >\r\n                    {baker?.name || 'Unknown Baker'}\r\n                  </div>\r\n                </div>\r\n              );\r\n            });\r\n          })()}\r\n\r\n          {showBakerSelect && bakerSelectPosition && (\r\n            <div\r\n              className={styles.bakerSelect}\r\n              style={{\r\n                position: 'fixed',\r\n                left: bakerSelectPosition.x,\r\n                top: bakerSelectPosition.y,\r\n                zIndex: 1000\r\n              }}\r\n            >\r\n              <div className={styles.bakerSelectHeader}>\r\n                Assign Baker\r\n                <button onClick={() => setShowBakerSelect(false)}>×</button>\r\n              </div>\r\n              <div className={styles.bakerSelectOptions}>\r\n                {bakers.map(b => (\r\n                  <button\r\n                    key={b.id}\r\n                    className={styles.bakerOption}\r\n                    onClick={() => handleBakerSelect(b.id)}\r\n                  >\r\n                    {b.name}\r\n                  </button>\r\n                ))}\r\n                <button\r\n                  className={styles.removeOption}\r\n                  onClick={() => {\r\n                    const allTagged = Object.values(taggedCookies[currentCategory.id] || {}).flat();\r\n                    const cookieId = selectedDetectedCookie?.id;\r\n                    const tagged = allTagged.find(t => t.detectedCookieId === cookieId);\r\n                    if (tagged) onCookieRemove(tagged);\r\n                    setShowBakerSelect(false);\r\n                  }}\r\n                >\r\n                  Remove Tag\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className={styles.actions}>\r\n        <button onClick={() => onCategoryChange(Math.max(0, currentCategoryIndex - 1))} className={styles.buttonSecondary}>\r\n          ← Back\r\n        </button>\r\n        <button\r\n          onClick={onAutoDetect}\r\n          className={styles.buttonSecondary}\r\n          disabled={detecting}\r\n        >\r\n          {detecting ? 'Detecting...' : '✨ Auto-Detect All'}\r\n        </button>\r\n        <button onClick={onComplete} className={styles.buttonPrimary}>\r\n          Finish & Save\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\EventSetupWizard.stories.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\EventSetupWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Category' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'sanitizeInput' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CONSTANTS' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'event' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":30,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCategoryCompletion' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'categoryId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCategoryId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'nextStep' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'prevStep' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":117,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":21},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":136,"column":35,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":136,"endColumn":52},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":136,"column":54,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":136,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":139,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":139,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":219,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":219,"endColumn":21},{"ruleId":"jsx-a11y/click-events-have-key-events","severity":1,"message":"Visible, non-interactive elements with click handlers must have at least one keyboard listener.","line":236,"column":25,"nodeType":"JSXOpeningElement","endLine":240,"endColumn":26},{"ruleId":"jsx-a11y/no-static-element-interactions","severity":1,"message":"Avoid non-native interactive elements. If using native HTML is not possible, add an appropriate role and support for tabbing, mouse, keyboard, and touch inputs to an interactive content element.","line":236,"column":25,"nodeType":"JSXOpeningElement","endLine":240,"endColumn":26}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { type Category, type CookieCoordinate } from '../../../lib/types';\r\nimport { uploadImage } from '../../../lib/storage';\r\nimport { sanitizeInput } from '../../../lib/validation';\r\nimport { CONSTANTS } from '../../../lib/constants';\r\nimport { detectCookiesGemini } from '../../../lib/cookieDetectionGemini';\r\nimport { useEvent } from '../../../lib/hooks/useEvent';\r\nimport { useCategories } from '../../../lib/hooks/useCategories';\r\nimport { useBakers } from '../../../lib/hooks/useBakers';\r\nimport { useImageDetection } from '../../../lib/hooks/useImageDetection';\r\nimport { useEventSetupState, type SetupStep } from '../../../lib/hooks/useEventSetupState';\r\nimport { sortAndNumberCookies } from '../../../lib/cookieUtils';\r\nimport { ImageUploadStep, type UploadedImage } from './ImageUploadStep';\r\nimport { CategoryNamingStep } from './CategoryNamingStep';\r\nimport { BakerSetupStep } from './BakerSetupStep';\r\nimport { CookieTaggingStep } from './CookieTaggingStep';\r\nimport { type DetectedCookie } from '../CookieViewer/CookieViewer';\r\nimport styles from './EventSetupWizard.module.css';\r\n\r\ninterface Props {\r\n    eventId: string;\r\n    eventName: string;\r\n    onComplete: () => void;\r\n    onCancel: () => void;\r\n    initialCategoryId?: string;\r\n}\r\n\r\nexport function EventSetupWizard({ eventId, eventName, onComplete, onCancel, initialCategoryId }: Props) {\r\n    const { event, loading: eventLoading } = useEvent(eventId);\r\n    const { categories, add: addCategory, update: updateCategoryCookies, loading: categoriesLoading } = useCategories(eventId);\r\n    const { bakers, add: addBaker, remove: removeBaker, loading: bakersLoading } = useBakers(eventId);\r\n\r\n    const [images, setImages] = useState<UploadedImage[]>([]);\r\n    const [uploading, setUploading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [currentCategoryIndex, setCurrentCategoryIndex] = useState(0);\r\n    const [taggedCookies, setTaggedCookies] = useState<Record<string, Record<string, CookieCoordinate[]>>>({});\r\n    const [categoryCompletion, setCategoryCompletion] = useState<Record<string, boolean>>({});\r\n    const [detecting, setDetecting] = useState(false);\r\n\r\n    const initialStep: SetupStep = initialCategoryId ? 'tagging' : (categories.length > 0 ? (bakers.length > 0 ? 'tagging' : 'bakers') : 'upload');\r\n\r\n    const { step, setStep, categoryId, setCategoryId, nextStep, prevStep } = useEventSetupState(\r\n        initialStep,\r\n        initialCategoryId || null\r\n    );\r\n\r\n    const currentCategory = categories[currentCategoryIndex];\r\n    const { detectedCookies, loading: loadingDetection } = useImageDetection(currentCategory?.imageUrl || null);\r\n\r\n    // Load existing data into taggedCookies\r\n    useEffect(() => {\r\n        if (categories.length > 0) {\r\n            const existingTagged: Record<string, Record<string, CookieCoordinate[]>> = {};\r\n            categories.forEach(cat => {\r\n                existingTagged[cat.id] = {};\r\n                cat.cookies.forEach(cookie => {\r\n                    const baker = bakers.find(b => b.name === cookie.makerName);\r\n                    if (baker) {\r\n                        if (!existingTagged[cat.id][baker.id]) {\r\n                            existingTagged[cat.id][baker.id] = [];\r\n                        }\r\n                        existingTagged[cat.id][baker.id].push(cookie);\r\n                    }\r\n                });\r\n            });\r\n            setTaggedCookies(existingTagged);\r\n\r\n            // Load categories into images for naming step\r\n            const categoryImages: UploadedImage[] = categories.map(cat => ({\r\n                file: {} as File,\r\n                preview: cat.imageUrl,\r\n                uploaded: true,\r\n                imageUrl: cat.imageUrl,\r\n                categoryName: cat.name\r\n            }));\r\n            setImages(categoryImages);\r\n        }\r\n    }, [categories, bakers]);\r\n\r\n    // Set initial category index if initialCategoryId is provided\r\n    useEffect(() => {\r\n        if (initialCategoryId && categories.length > 0) {\r\n            const idx = categories.findIndex(c => c.id === initialCategoryId);\r\n            if (idx !== -1) setCurrentCategoryIndex(idx);\r\n        }\r\n    }, [initialCategoryId, categories]);\r\n\r\n    const handleFilesSelect = (newFiles: UploadedImage[]) => {\r\n        setImages([...images, ...newFiles]);\r\n    };\r\n\r\n    const handleRemoveImage = (index: number) => {\r\n        const newImages = [...images];\r\n        URL.revokeObjectURL(newImages[index].preview);\r\n        newImages.splice(index, 1);\r\n        setImages(newImages);\r\n    };\r\n\r\n    const handleUploadImages = async () => {\r\n        if (images.length === 0) return;\r\n        setUploading(true);\r\n        setError(null);\r\n        try {\r\n            const uploaded: UploadedImage[] = [];\r\n            for (const img of images) {\r\n                if (img.uploaded) {\r\n                    uploaded.push(img);\r\n                    continue;\r\n                }\r\n                const url = await uploadImage(img.file, 'shared/cookies');\r\n                uploaded.push({ ...img, uploaded: true, imageUrl: url });\r\n            }\r\n            setImages(uploaded);\r\n            setStep('categories');\r\n        } catch (err) {\r\n            setError('Failed to upload images');\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleCategoryNameChange = (index: number, name: string) => {\r\n        const newImages = [...images];\r\n        newImages[index].categoryName = name;\r\n        setImages(newImages);\r\n    };\r\n\r\n    const handleCreateCategories = async () => {\r\n        setUploading(true);\r\n        setError(null);\r\n        try {\r\n            const imagesToCreate = images.filter(img => img.uploaded && img.categoryName?.trim() && !categories.some(c => c.imageUrl === img.imageUrl));\r\n            for (const img of imagesToCreate) {\r\n                await addCategory(img.categoryName!, img.imageUrl!);\r\n            }\r\n            setStep('bakers');\r\n        } catch (err) {\r\n            setError('Failed to create categories');\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleAddBaker = async (name: string) => {\r\n        await addBaker(name);\r\n    };\r\n\r\n    const handleRemoveBaker = async (id: string) => {\r\n        await removeBaker(id);\r\n    };\r\n\r\n    const handleCookieTag = async (cookie: DetectedCookie, bakerId: string) => {\r\n        if (!currentCategory) return;\r\n        const baker = bakers.find(b => b.id === bakerId);\r\n        if (!baker) return;\r\n\r\n        const newCookie: CookieCoordinate = {\r\n            id: uuidv4(),\r\n            number: 0,\r\n            makerName: baker.name,\r\n            x: cookie.x,\r\n            y: cookie.y,\r\n            detectedCookieId: cookie.id\r\n        };\r\n\r\n        const updatedTagged = { ...taggedCookies };\r\n        if (!updatedTagged[currentCategory.id]) updatedTagged[currentCategory.id] = {};\r\n        if (!updatedTagged[currentCategory.id][bakerId]) updatedTagged[currentCategory.id][bakerId] = [];\r\n        updatedTagged[currentCategory.id][bakerId].push(newCookie);\r\n\r\n        // Autosave\r\n        const allCookies = Object.values(updatedTagged[currentCategory.id]).flat();\r\n        const sorted = sortAndNumberCookies(allCookies);\r\n        await updateCategoryCookies(currentCategory.id, { cookies: sorted });\r\n        setTaggedCookies(updatedTagged);\r\n    };\r\n\r\n    const handleCookieRemove = async (cookie: CookieCoordinate) => {\r\n        if (!currentCategory) return;\r\n        const updatedTagged = { ...taggedCookies };\r\n        const catTagged = updatedTagged[currentCategory.id];\r\n        if (!catTagged) return;\r\n\r\n        Object.keys(catTagged).forEach(bakerId => {\r\n            catTagged[bakerId] = catTagged[bakerId].filter(c => c.id !== cookie.id);\r\n        });\r\n\r\n        const allCookies = Object.values(catTagged).flat();\r\n        const sorted = sortAndNumberCookies(allCookies);\r\n        await updateCategoryCookies(currentCategory.id, { cookies: sorted });\r\n        setTaggedCookies(updatedTagged);\r\n    };\r\n\r\n    const handleAutoDetect = async () => {\r\n        if (!currentCategory || bakers.length === 0) return;\r\n        setDetecting(true);\r\n        try {\r\n            const detected = await detectCookiesGemini(currentCategory.imageUrl);\r\n            const defaultBaker = bakers[0];\r\n            const newCookies: CookieCoordinate[] = detected.map(d => ({\r\n                id: uuidv4(),\r\n                number: 0,\r\n                makerName: defaultBaker.name,\r\n                x: d.x,\r\n                y: d.y,\r\n                detectedCookieId: d.id || `detected_${uuidv4()}`\r\n            }));\r\n\r\n            const updatedTagged = { ...taggedCookies };\r\n            if (!updatedTagged[currentCategory.id]) updatedTagged[currentCategory.id] = {};\r\n            updatedTagged[currentCategory.id][defaultBaker.id] = [...(updatedTagged[currentCategory.id][defaultBaker.id] || []), ...newCookies];\r\n\r\n            const allCookies = Object.values(updatedTagged[currentCategory.id]).flat();\r\n            const sorted = sortAndNumberCookies(allCookies);\r\n            await updateCategoryCookies(currentCategory.id, { cookies: sorted });\r\n            setTaggedCookies(updatedTagged);\r\n        } catch (err) {\r\n            setError('Auto-detection failed');\r\n        } finally {\r\n            setDetecting(false);\r\n        }\r\n    };\r\n\r\n    if (eventLoading || categoriesLoading || bakersLoading) {\r\n        return <div className={styles.loading}>Loading Wizard...</div>;\r\n    }\r\n\r\n    return (\r\n        <div className={styles.wizard}>\r\n            <div className={styles.header}>\r\n                <h1>Edit Event: {eventName}</h1>\r\n                <div className={styles.steps}>\r\n                    {(['upload', 'categories', 'bakers', 'tagging'] as SetupStep[]).map((s, idx) => (\r\n                        <div\r\n                            key={s}\r\n                            className={`${styles.step} ${step === s ? styles.active : ''}`}\r\n                            onClick={() => categories.length > 0 && setStep(s)}\r\n                        >\r\n                            <span className={styles.stepNumber}>{idx + 1}</span>\r\n                            <span className={styles.stepLabel}>{s.charAt(0).toUpperCase() + s.slice(1)}</span>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.content}>\r\n                {step === 'upload' && (\r\n                    <ImageUploadStep\r\n                        images={images}\r\n                        uploading={uploading}\r\n                        onFilesSelect={handleFilesSelect}\r\n                        onRemoveImage={handleRemoveImage}\r\n                        onUpload={handleUploadImages}\r\n                        onCancel={onCancel}\r\n                        onNext={() => setStep('categories')}\r\n                        hasExistingCategories={categories.length > 0}\r\n                        error={error}\r\n                    />\r\n                )}\r\n                {step === 'categories' && (\r\n                    <CategoryNamingStep\r\n                        images={images}\r\n                        uploading={uploading}\r\n                        onNameChange={handleCategoryNameChange}\r\n                        onCreateCategories={handleCreateCategories}\r\n                        onBack={() => setStep('upload')}\r\n                        onNext={() => setStep('bakers')}\r\n                        hasExistingCategories={categories.length > 0}\r\n                        error={error}\r\n                    />\r\n                )}\r\n                {step === 'bakers' && (\r\n                    <BakerSetupStep\r\n                        bakers={bakers}\r\n                        onAddBaker={handleAddBaker}\r\n                        onRemoveBaker={handleRemoveBaker}\r\n                        onBack={() => setStep('categories')}\r\n                        onNext={() => setStep('tagging')}\r\n                        hasExistingCategories={categories.length > 0}\r\n                        error={error}\r\n                    />\r\n                )}\r\n                {step === 'tagging' && currentCategory && (\r\n                    <CookieTaggingStep\r\n                        currentCategory={currentCategory}\r\n                        categories={categories}\r\n                        currentCategoryIndex={currentCategoryIndex}\r\n                        onCategoryChange={setCurrentCategoryIndex}\r\n                        bakers={bakers}\r\n                        currentBaker={bakers[0] || null}\r\n                        taggedCookies={taggedCookies}\r\n                        detectedCookies={detectedCookies}\r\n                        loadingDetection={loadingDetection}\r\n                        onCookieTag={handleCookieTag}\r\n                        onCookieRemove={handleCookieRemove}\r\n                        onAutoDetect={handleAutoDetect}\r\n                        onComplete={onComplete}\r\n                        categoryCompletion={categoryCompletion}\r\n                        error={error}\r\n                        detecting={detecting}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\ImageUploadStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CONSTANTS' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef } from 'react';\r\nimport { validateImage } from '../../../lib/validation';\r\nimport { CONSTANTS } from '../../../lib/constants';\r\nimport styles from './EventSetupWizard.module.css';\r\n\r\nexport interface UploadedImage {\r\n  file: File;\r\n  preview: string;\r\n  uploaded: boolean;\r\n  imageUrl?: string;\r\n  categoryName?: string;\r\n  name?: string;\r\n}\r\n\r\ninterface Props {\r\n  images: UploadedImage[];\r\n  uploading: boolean;\r\n  onFilesSelect: (files: UploadedImage[]) => void;\r\n  onRemoveImage: (index: number) => void;\r\n  onUpload: () => Promise<void>;\r\n  onCancel: () => void;\r\n  onNext: () => void;\r\n  hasExistingCategories: boolean;\r\n  error?: string | null;\r\n}\r\n\r\nexport function ImageUploadStep({\r\n  images,\r\n  uploading,\r\n  onFilesSelect,\r\n  onRemoveImage,\r\n  onUpload,\r\n  onCancel,\r\n  onNext,\r\n  hasExistingCategories,\r\n  error\r\n}: Props) {\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (!e.target.files) return;\r\n\r\n    const files = Array.from(e.target.files);\r\n    const validFiles: UploadedImage[] = [];\r\n\r\n    for (const file of files) {\r\n      const validation = validateImage(file);\r\n      if (validation.valid) {\r\n        validFiles.push({\r\n          file,\r\n          preview: URL.createObjectURL(file),\r\n          uploaded: false,\r\n          name: file.name\r\n        });\r\n      }\r\n    }\r\n\r\n    onFilesSelect(validFiles);\r\n    if (e.target.files) {\r\n      e.target.value = '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={styles.stepContent}>\r\n      <h2>Upload Cookie Images</h2>\r\n      <p className={styles.instruction}>Upload all cookie images at once (typically ~10 images)</p>\r\n\r\n      <input\r\n        ref={fileInputRef}\r\n        type=\"file\"\r\n        accept=\"image/jpeg,image/jpg,image/png,image/webp,image/gif\"\r\n        multiple\r\n        onChange={handleFileSelect}\r\n        className={styles.fileInput}\r\n        disabled={uploading}\r\n      />\r\n\r\n      {images.length > 0 && (\r\n        <div className={styles.imageGrid}>\r\n          {images.map((img, index) => {\r\n            const imageKey = img.name || img.preview || `image-${index}`;\r\n            const uniqueKey = `upload-${imageKey.slice(-50)}-${index}`;\r\n            return (\r\n              <div key={uniqueKey} className={styles.imageCard}>\r\n                <img src={img.preview} alt={`Preview ${index + 1}`} />\r\n                <button\r\n                  onClick={() => onRemoveImage(index)}\r\n                  className={styles.removeButton}\r\n                  disabled={uploading}\r\n                >\r\n                  ×\r\n                </button>\r\n                {img.uploaded && (\r\n                  <div className={styles.uploadedBadge}>✓ Uploaded</div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n\r\n      {error && <div className={styles.error}>{error}</div>}\r\n\r\n      <div className={styles.actions}>\r\n        <button onClick={onCancel} className={styles.buttonSecondary} disabled={uploading}>\r\n          Cancel\r\n        </button>\r\n        {hasExistingCategories && (\r\n          <button\r\n            onClick={onNext}\r\n            className={styles.buttonSecondary}\r\n            disabled={uploading}\r\n          >\r\n            Next: Name Categories →\r\n          </button>\r\n        )}\r\n        <button\r\n          onClick={onUpload}\r\n          disabled={uploading || images.length === 0}\r\n          className={styles.buttonPrimary}\r\n        >\r\n          {uploading ? 'Uploading...' : hasExistingCategories ? 'Add More Images' : `Upload ${images.length} Image${images.length !== 1 ? 's' : ''}`}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\EventSetupWizard\\WizardSteps.stories.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CookieTaggingStep' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Meta, StoryObj } from '@storybook/react';\r\nimport { ImageUploadStep } from './ImageUploadStep';\r\nimport { CategoryNamingStep } from './CategoryNamingStep';\r\nimport { BakerSetupStep } from './BakerSetupStep';\r\nimport { CookieTaggingStep } from './CookieTaggingStep';\r\n\r\nconst meta: Meta = {\r\n  title: 'Organisms/EventSetupWizard/Steps',\r\n  parameters: {\r\n    layout: 'fullscreen',\r\n  },\r\n};\r\n\r\nexport default meta;\r\n\r\nexport const ImageUpload: StoryObj<typeof ImageUploadStep> = {\r\n  render: () => (\r\n    <ImageUploadStep\r\n      images={[]}\r\n      uploading={false}\r\n      onFilesSelect={() => {}}\r\n      onRemoveImage={() => {}}\r\n      onUpload={async () => {}}\r\n      onCancel={() => {}}\r\n      onNext={() => {}}\r\n      hasExistingCategories={false}\r\n    />\r\n  ),\r\n};\r\n\r\nexport const CategoryNaming: StoryObj<typeof CategoryNamingStep> = {\r\n  render: () => (\r\n    <CategoryNamingStep\r\n      images={[\r\n        { file: {} as File, preview: 'https://via.placeholder.com/150', uploaded: true, categoryName: 'Sugar Cookie' },\r\n        { file: {} as File, preview: 'https://via.placeholder.com/150', uploaded: true, categoryName: '' }\r\n      ]}\r\n      uploading={false}\r\n      onNameChange={() => {}}\r\n      onCreateCategories={async () => {}}\r\n      onBack={() => {}}\r\n      onNext={() => {}}\r\n      hasExistingCategories={true}\r\n    />\r\n  ),\r\n};\r\n\r\nexport const BakerSetup: StoryObj<typeof BakerSetupStep> = {\r\n  render: () => (\r\n    <BakerSetupStep\r\n      bakers={[\r\n        { id: '1', name: 'Alice' },\r\n        { id: '2', name: 'Bob' }\r\n      ]}\r\n      onAddBaker={async () => {}}\r\n      onRemoveBaker={async () => {}}\r\n      onBack={() => {}}\r\n      onNext={() => {}}\r\n      hasExistingCategories={true}\r\n    />\r\n  ),\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\ImageTagger\\ImageTagger.stories.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\components\\organisms\\ImageTagger\\ImageTagger.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\custom.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\cookieDetectionGemini.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\cookieUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\export.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\firestore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useAdmins.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1264,1267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1264,1267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1656,1659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1656,1659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { isGlobalAdmin } from '../firestore';\r\nimport { useAuth } from './useAuth';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../firebase';\r\n\r\nexport function useAdmins() {\r\n  const { user } = useAuth();\r\n  const [isAdmin, setIsAdmin] = useState<boolean | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const checkAdminStatus = useCallback(async () => {\r\n    if (!user) {\r\n      setIsAdmin(false);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const status = await isGlobalAdmin(user.uid);\r\n      setIsAdmin(status);\r\n    } catch (err) {\r\n      console.error('Error checking admin status:', err);\r\n      setError('Failed to verify admin permissions');\r\n      setIsAdmin(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    checkAdminStatus();\r\n  }, [checkAdminStatus]);\r\n\r\n  const add = async (email: string) => {\r\n    try {\r\n      const addAdminRole = httpsCallable(functions, 'addAdminRole');\r\n      const result = await addAdminRole({ email });\r\n      console.log('Admin added:', result.data);\r\n    } catch (err: any) {\r\n      console.error('Error adding admin:', err);\r\n      throw new Error(err.message || 'Failed to add admin');\r\n    }\r\n  };\r\n\r\n  const remove = async (email: string) => {\r\n    try {\r\n      const removeAdminRole = httpsCallable(functions, 'removeAdminRole');\r\n      const result = await removeAdminRole({ email });\r\n      console.log('Admin removed:', result.data);\r\n    } catch (err: any) {\r\n      console.error('Error removing admin:', err);\r\n      throw new Error(err.message || 'Failed to remove admin');\r\n    }\r\n  };\r\n\r\n  return { isAdmin, loading, error, add, remove, refresh: checkAdminStatus };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useBakers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useCategories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useEvent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useEventSetupState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\hooks\\useImageDetection.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":8,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1033,1036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1033,1036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { watchImageDetectionResults, getAllImageDetections } from '../firestore';\r\nimport { type DetectedCookie } from '../../components/organisms/CookieViewer/CookieViewer';\r\n\r\nexport function useImageDetection(imageUrl: string | null) {\r\n  const [detectedCookies, setDetectedCookies] = useState<DetectedCookie[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!imageUrl) {\r\n      setDetectedCookies([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    const unsubscribe = watchImageDetectionResults(imageUrl, (results) => {\r\n      setDetectedCookies(results || []);\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [imageUrl]);\r\n\r\n  return { detectedCookies, loading, error };\r\n}\r\n\r\n/**\r\n * Hook to fetch all detections at once (useful for audit or global lists)\r\n */\r\nexport function useAllDetections() {\r\n  const [detections, setDetections] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      try {\r\n        const data = await getAllImageDetections();\r\n        setDetections(data);\r\n        setError(null);\r\n      } catch (err) {\r\n        console.error('Error loading all detections:', err);\r\n        setError('Failed to load detections');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n  }, []);\r\n\r\n  return { detections, loading, error };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\labelPositioning.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\lib\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\AdminDashboard.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleAddAdminByUserId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":266,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":266,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\AdminHome.tsx","messages":[{"ruleId":"jsx-a11y/no-noninteractive-element-interactions","severity":1,"message":"Non-interactive elements should not be assigned mouse or keyboard event listeners.","line":626,"column":21,"nodeType":"JSXOpeningElement","endLine":637,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { onAuthStateChanged } from 'firebase/auth';\r\nimport { auth } from '../lib/firebase';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../lib/firebase';\r\nimport { doc, onSnapshot, collection, query, where, getDocs, limit } from 'firebase/firestore';\r\nimport { db } from '../lib/firebase';\r\nimport { createEvent, getAllEvents, deleteEvent, getCategories, isGlobalAdmin } from '../lib/firestore';\r\nimport { validateEventName, sanitizeInput } from '../lib/validation';\r\nimport { CONSTANTS } from '../lib/constants';\r\nimport { AlertModal } from '../components/atoms/AlertModal/AlertModal';\r\nimport styles from './AdminHome.module.css';\r\nimport { type VoteEvent } from '../lib/types';\r\n\r\nexport default function AdminHome() {\r\n    const [eventName, setEventName] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [deleting, setDeleting] = useState<string | null>(null);\r\n    const [events, setEvents] = useState<VoteEvent[]>([]);\r\n    const [eventImages, setEventImages] = useState<Record<string, string[]>>({});\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [loadingEvents, setLoadingEvents] = useState(true);\r\n    const [checkingAuth, setCheckingAuth] = useState(true);\r\n    const [isAdmin, setIsAdmin] = useState(false);\r\n    const [checkingAccess, setCheckingAccess] = useState(true);\r\n    const [confirmDelete, setConfirmDelete] = useState<string | null>(null);\r\n    const [detectingAll, setDetectingAll] = useState(false);\r\n    const [detectionProgress, setDetectionProgress] = useState<string | null>(null);\r\n    const [currentJobId, setCurrentJobId] = useState<string | null>(null);\r\n    const [alertMessage, setAlertMessage] = useState<string | null>(null);\r\n    const [alertType, setAlertType] = useState<'success' | 'error' | 'info'>('info');\r\n    const navigate = useNavigate();\r\n\r\n    // Check authentication and admin access\r\n    useEffect(() => {\r\n        const checkAccess = async () => {\r\n            setCheckingAccess(true);\r\n            try {\r\n                // Get current user\r\n                const user = auth.currentUser;\r\n                \r\n                // A user is considered signed in if they have an email or provider data\r\n                const isSignedIn = user && (\r\n                    user.email || \r\n                    (user.providerData && user.providerData.length > 0)\r\n                );\r\n                \r\n                if (!isSignedIn) {\r\n                    // Not signed in, redirect to landing page\r\n                    navigate('/', { replace: true });\r\n                    setIsAdmin(false);\r\n                    setCheckingAuth(false);\r\n                    setCheckingAccess(false);\r\n                    return;\r\n                }\r\n\r\n                setCheckingAuth(false);\r\n                \r\n                // Check if user is an admin\r\n                const admin = await isGlobalAdmin(user.uid);\r\n                setIsAdmin(admin);\r\n\r\n                if (!admin) {\r\n                    setError('You do not have admin access. Please contact a site administrator.');\r\n                    setLoadingEvents(false);\r\n                    setCheckingAccess(false);\r\n                    return;\r\n                }\r\n\r\n                // User is admin, proceed to load events\r\n                setCheckingAccess(false);\r\n            } catch (err) {\r\n                console.error(\"Failed to check admin access\", err);\r\n                setError(CONSTANTS.ERROR_MESSAGES.FAILED_TO_LOAD);\r\n                setCheckingAuth(false);\r\n                setCheckingAccess(false);\r\n            }\r\n        };\r\n\r\n        // Listen for auth state changes\r\n        const unsubscribe = onAuthStateChanged(auth, async () => {\r\n            await checkAccess();\r\n        });\r\n\r\n        // Also check immediately\r\n        checkAccess();\r\n\r\n        return () => unsubscribe();\r\n    }, [navigate]);\r\n\r\n    // Check for running detection jobs on mount\r\n    useEffect(() => {\r\n        if (checkingAuth || checkingAccess || !isAdmin) return;\r\n\r\n        const checkRunningJobs = async () => {\r\n            try {\r\n                // Query without orderBy to avoid needing an index\r\n                // We'll check both statuses separately and take the most recent\r\n                const jobsRef = collection(db, 'detection_jobs');\r\n                \r\n                // Check for processing jobs first (most likely to be active)\r\n                const processingQuery = query(\r\n                    jobsRef,\r\n                    where('status', '==', 'processing'),\r\n                    limit(1)\r\n                );\r\n                const processingSnapshot = await getDocs(processingQuery);\r\n                \r\n                if (!processingSnapshot.empty) {\r\n                    const jobDoc = processingSnapshot.docs[0];\r\n                    setCurrentJobId(jobDoc.id);\r\n                    setDetectingAll(true);\r\n                    setDetectionProgress('Found running detection job. Watching progress...');\r\n                    return;\r\n                }\r\n                \r\n                // If no processing job, check for queued jobs\r\n                const queuedQuery = query(\r\n                    jobsRef,\r\n                    where('status', '==', 'queued'),\r\n                    limit(1)\r\n                );\r\n                const queuedSnapshot = await getDocs(queuedQuery);\r\n                \r\n                if (!queuedSnapshot.empty) {\r\n                    const jobDoc = queuedSnapshot.docs[0];\r\n                    setCurrentJobId(jobDoc.id);\r\n                    setDetectingAll(true);\r\n                    setDetectionProgress('Found queued detection job. Watching progress...');\r\n                }\r\n            } catch (error) {\r\n                console.error('Error checking for running jobs:', error);\r\n            }\r\n        };\r\n\r\n        checkRunningJobs();\r\n    }, [checkingAuth, checkingAccess, isAdmin]);\r\n\r\n    useEffect(() => {\r\n        // Only fetch events if user is admin and access check is complete\r\n        if (checkingAuth || checkingAccess || !isAdmin) return;\r\n\r\n        const fetchEvents = async () => {\r\n            try {\r\n                const allEvents = await getAllEvents();\r\n                // Sort by most recent first (createdAt is timestamp)\r\n                const sortedEvents = allEvents.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));\r\n                setEvents(sortedEvents);\r\n\r\n                // Fetch images for each event\r\n                const imagesMap: Record<string, string[]> = {};\r\n                await Promise.all(\r\n                    sortedEvents.map(async (event) => {\r\n                        try {\r\n                            const categories = await getCategories(event.id);\r\n                            imagesMap[event.id] = categories.map(cat => cat.imageUrl);\r\n                        } catch (err) {\r\n                            console.error(`Failed to load images for event ${event.id}`, err);\r\n                            imagesMap[event.id] = [];\r\n                        }\r\n                    })\r\n                );\r\n                setEventImages(imagesMap);\r\n            } catch (err) {\r\n                console.error(\"Failed to load events\", err);\r\n                setError(CONSTANTS.ERROR_MESSAGES.FAILED_TO_LOAD);\r\n            } finally {\r\n                setLoadingEvents(false);\r\n            }\r\n        };\r\n        fetchEvents();\r\n    }, [checkingAuth, checkingAccess, isAdmin]);\r\n\r\n    const handleCreate = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        \r\n        // Validate event name\r\n        const validation = validateEventName(eventName);\r\n        if (!validation.valid) {\r\n            setError(validation.error || 'Invalid event name');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError(null);\r\n        \r\n        try {\r\n            const sanitizedName = sanitizeInput(eventName);\r\n            const event = await createEvent(sanitizedName);\r\n            // Navigate directly to admin page\r\n            navigate(`/admin/${event.id}`);\r\n        } catch (error) {\r\n            console.error(\"Error creating event:\", error);\r\n            let errorMessage = error instanceof Error \r\n                ? error.message \r\n                : CONSTANTS.ERROR_MESSAGES.FAILED_TO_SAVE;\r\n            \r\n            // Provide more helpful error message for permission errors\r\n            if (error instanceof Error && (error.message.includes('permission') || error.message.includes('Permission'))) {\r\n                const currentUser = auth.currentUser;\r\n                \r\n                if (currentUser) {\r\n                    errorMessage = `Permission denied: Your account (${currentUser.email || currentUser.uid}) is not a global admin. Use the local script to bootstrap your admin access: node scripts/set-admin.js ${currentUser.email}`;\r\n                } else {\r\n                    errorMessage = 'Permission denied: You must be signed in as a global admin to create events.';\r\n                }\r\n            }\r\n            \r\n            setError(errorMessage);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteClick = (eventId: string) => {\r\n        setConfirmDelete(eventId);\r\n    };\r\n\r\n    const handleDeleteConfirm = async () => {\r\n        if (!confirmDelete) return;\r\n        \r\n        const eventId = confirmDelete;\r\n        setConfirmDelete(null);\r\n        setDeleting(eventId);\r\n        try {\r\n            await deleteEvent(eventId);\r\n            // Wait for fade-out animation to complete before removing from list\r\n            await new Promise(resolve => setTimeout(resolve, 300));\r\n            // Update state to remove deleted event (event is deleted even if storage cleanup failed)\r\n            setEvents(events.filter(event => event.id !== eventId));\r\n            // Remove images from state\r\n            const newImages = { ...eventImages };\r\n            delete newImages[eventId];\r\n            setEventImages(newImages);\r\n        } catch (error) {\r\n            console.error(\"Error deleting event:\", error);\r\n            // Check if it's a storage error - if so, event was still deleted from Firestore\r\n            const isStorageError = error instanceof Error && \r\n                (error.message.includes('storage') || error.message.includes('Storage'));\r\n            \r\n            if (isStorageError) {\r\n                // Event was deleted from Firestore, just storage cleanup failed\r\n                // Still update state to reflect the deletion\r\n                setEvents(events.filter(event => event.id !== eventId));\r\n                const newImages = { ...eventImages };\r\n                delete newImages[eventId];\r\n                setEventImages(newImages);\r\n                // Show a warning but don't treat it as a failure\r\n                setError('Event deleted, but some files may not have been removed from storage.');\r\n            } else {\r\n                // Real error - event deletion failed\r\n                const errorMessage = error instanceof Error \r\n                    ? error.message \r\n                    : CONSTANTS.ERROR_MESSAGES.FAILED_TO_DELETE;\r\n                setError(errorMessage);\r\n            }\r\n        } finally {\r\n            setDeleting(null);\r\n        }\r\n    };\r\n\r\n    const handleDeleteCancel = () => {\r\n        setConfirmDelete(null);\r\n    };\r\n\r\n    // Watch job status when a job is active\r\n    useEffect(() => {\r\n        if (!currentJobId) return;\r\n\r\n        const jobRef = doc(db, 'detection_jobs', currentJobId);\r\n        const unsubscribe = onSnapshot(\r\n            jobRef,\r\n            (snapshot) => {\r\n                if (!snapshot.exists()) {\r\n                    setDetectionProgress(null);\r\n                    setDetectingAll(false);\r\n                    return;\r\n                }\r\n\r\n                const jobData = snapshot.data();\r\n                const status = jobData.status;\r\n                const total = jobData.total || 0;\r\n                const processed = jobData.processed || 0;\r\n                const skipped = jobData.skipped || 0;\r\n                const errors = jobData.errors || 0;\r\n                const currentFile = jobData.currentFile || '';\r\n                const currentIndex = jobData.currentIndex || 0;\r\n\r\n                if (status === 'queued') {\r\n                    setDetectionProgress('Job queued, starting soon...');\r\n                } else if (status === 'processing') {\r\n                    if (total > 0) {\r\n                        const progress = Math.round(((processed + skipped + errors) / total) * 100);\r\n                        setDetectionProgress(\r\n                            `Processing ${currentIndex}/${total}: ${currentFile}\\n` +\r\n                            `Progress: ${progress}% (${processed} processed, ${skipped} skipped, ${errors} errors)`\r\n                        );\r\n                    } else {\r\n                        setDetectionProgress('Scanning for images...');\r\n                    }\r\n                } else if (status === 'completed') {\r\n                    setDetectingAll(false);\r\n                    setDetectionProgress(null);\r\n                    setCurrentJobId(null);\r\n                    const message = `Detection complete!\\n` +\r\n                        `Total images: ${total}\\n` +\r\n                        `Processed: ${processed}\\n` +\r\n                        `Skipped (already detected): ${skipped}\\n` +\r\n                        `Errors: ${errors}`;\r\n                    setAlertMessage(message);\r\n                    setAlertType(errors > 0 ? 'error' : 'success');\r\n                } else if (status === 'cancelled') {\r\n                    setDetectingAll(false);\r\n                    setDetectionProgress(null);\r\n                    setCurrentJobId(null);\r\n                    setAlertMessage('Detection job cancelled');\r\n                    setAlertType('info');\r\n                } else if (status === 'error') {\r\n                    setDetectingAll(false);\r\n                    setDetectionProgress(null);\r\n                    setCurrentJobId(null);\r\n                    setAlertMessage(`Detection failed: ${jobData.error || 'Unknown error'}`);\r\n                    setAlertType('error');\r\n                }\r\n            },\r\n            (error) => {\r\n                console.error('Error watching job status:', error);\r\n                setDetectingAll(false);\r\n                setDetectionProgress(null);\r\n                setCurrentJobId(null);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [currentJobId]);\r\n\r\n    const handleDetectAllImages = async () => {\r\n        if (!window.confirm('This will detect cookies in all images in shared storage. This may take a few minutes. Continue?')) {\r\n            return;\r\n        }\r\n\r\n        setDetectingAll(true);\r\n        setDetectionProgress('Starting detection job...');\r\n        setError(null);\r\n        setCurrentJobId(null);\r\n\r\n        try {\r\n            const detectAllImages = httpsCallable<Record<string, never>, {\r\n                jobId: string;\r\n                status: string;\r\n                message: string;\r\n            }>(functions, 'detectAllImages');\r\n\r\n            const result = await detectAllImages({});\r\n            const data = result.data;\r\n\r\n            if (data && data.jobId) {\r\n                if (data.status === 'already_running') {\r\n                    // A job is already running - start watching it\r\n                    setCurrentJobId(data.jobId);\r\n                    setDetectingAll(true);\r\n                    setDetectionProgress('A detection job is already running. Watching progress...');\r\n                } else {\r\n                    // Start watching the new job\r\n                    setCurrentJobId(data.jobId);\r\n                    setDetectionProgress('Job started, waiting for progress...');\r\n                }\r\n            } else {\r\n                setAlertMessage('Failed to start detection job');\r\n                setAlertType('error');\r\n                setDetectingAll(false);\r\n                setDetectionProgress(null);\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to start detection job:', err);\r\n            const errorMessage = err instanceof Error ? err.message : 'Failed to start detection job';\r\n            setAlertMessage(`Failed to start detection: ${errorMessage}`);\r\n            setAlertType('error');\r\n            setDetectingAll(false);\r\n            setDetectionProgress(null);\r\n        }\r\n    };\r\n\r\n    const handleCancelDetection = async () => {\r\n        if (!currentJobId) return;\r\n        \r\n        if (!window.confirm('Are you sure you want to cancel the detection job? It will stop processing after the current image.')) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const cancelDetectionJob = httpsCallable<{ jobId: string }, {\r\n                success: boolean;\r\n                message: string;\r\n            }>(functions, 'cancelDetectionJob');\r\n\r\n            await cancelDetectionJob({ jobId: currentJobId });\r\n            setAlertMessage('Cancellation requested. The job will stop after processing the current image.');\r\n            setAlertType('info');\r\n        } catch (err) {\r\n            console.error('Failed to cancel detection job:', err);\r\n            const errorMessage = err instanceof Error ? err.message : 'Failed to cancel detection job';\r\n            setAlertMessage(`Failed to cancel: ${errorMessage}`);\r\n            setAlertType('error');\r\n        }\r\n    };\r\n\r\n    if (checkingAuth || checkingAccess) {\r\n        return <div className={styles.container}>Loading...</div>;\r\n    }\r\n\r\n    if (!isAdmin) {\r\n        return (\r\n            <div className={styles.container}>\r\n                <div className={styles.error}>\r\n                    {error || 'You do not have admin access. Please contact a site administrator.'}\r\n                </div>\r\n                <button onClick={() => navigate('/')} className={styles.button} style={{ marginTop: '1rem' }}>\r\n                    Go Home\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            {alertMessage && (\r\n                <AlertModal\r\n                    message={alertMessage}\r\n                    type={alertType}\r\n                    onClose={() => setAlertMessage(null)}\r\n                />\r\n            )}\r\n            <section className={styles.section}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem', flexWrap: 'wrap', gap: '1rem' }}>\r\n                    <h1 style={{ margin: 0 }}>Create Voting Event</h1>\r\n                    <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>\r\n                        <button\r\n                            onClick={() => window.open('/admin/audit/detections', '_blank')}\r\n                            className={styles.button}\r\n                            style={{\r\n                                background: 'rgba(33, 150, 243, 0.8)',\r\n                                color: 'white',\r\n                                border: 'none',\r\n                                padding: '0.75rem 1.5rem',\r\n                                borderRadius: '6px',\r\n                                cursor: 'pointer',\r\n                                fontWeight: '600',\r\n                                fontSize: '0.9rem',\r\n                                transition: 'background 0.2s'\r\n                            }}\r\n                        >\r\n                            🔍 Image Detection Audit\r\n                        </button>\r\n                        {detectingAll && currentJobId && (\r\n                            <button\r\n                                onClick={handleCancelDetection}\r\n                                className={styles.button}\r\n                                style={{\r\n                                    background: 'rgba(244, 67, 54, 0.8)',\r\n                                    color: 'white',\r\n                                    border: 'none',\r\n                                    padding: '0.75rem 1.5rem',\r\n                                    borderRadius: '6px',\r\n                                    cursor: 'pointer',\r\n                                    fontWeight: '600',\r\n                                    fontSize: '0.9rem',\r\n                                    transition: 'background 0.2s'\r\n                                }}\r\n                            >\r\n                                ⏹️ Stop Detection\r\n                            </button>\r\n                        )}\r\n                        <button\r\n                            onClick={handleDetectAllImages}\r\n                            disabled={detectingAll}\r\n                            className={styles.button}\r\n                            style={{\r\n                                background: detectingAll ? 'rgba(76, 175, 80, 0.5)' : 'rgba(76, 175, 80, 0.8)',\r\n                                color: 'white',\r\n                                border: 'none',\r\n                                padding: '0.75rem 1.5rem',\r\n                                borderRadius: '6px',\r\n                                cursor: detectingAll ? 'not-allowed' : 'pointer',\r\n                                fontWeight: '600',\r\n                                fontSize: '0.9rem',\r\n                                transition: 'background 0.2s'\r\n                            }}\r\n                        >\r\n                            {detectingAll ? '🔄 Detecting...' : '🔍 Auto-detect All Images'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                {detectionProgress && (\r\n                    <div style={{ \r\n                        marginBottom: '1rem',\r\n                        padding: '0.75rem 1rem', \r\n                        background: 'rgba(76, 175, 80, 0.2)', \r\n                        border: '1px solid rgba(76, 175, 80, 0.5)', \r\n                        borderRadius: '6px',\r\n                        color: '#c8e6c9',\r\n                        fontSize: '0.875rem'\r\n                    }}>\r\n                        {detectionProgress}\r\n                    </div>\r\n                )}\r\n                {error && (\r\n                    <div className={styles.error} style={{ marginBottom: '1rem' }}>\r\n                        {error}\r\n                    </div>\r\n                )}\r\n                <form onSubmit={handleCreate} className={styles.form}>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Event Name (e.g. Holiday Cookie-Off)\"\r\n                        value={eventName}\r\n                        onChange={(e) => {\r\n                            setEventName(e.target.value);\r\n                            setError(null);\r\n                        }}\r\n                        className={styles.input}\r\n                        disabled={loading}\r\n                        maxLength={100}\r\n                        required\r\n                    />\r\n                    <button type=\"submit\" disabled={loading} className={styles.button}>\r\n                        {loading ? 'Creating...' : 'Create Event'}\r\n                    </button>\r\n                </form>\r\n            </section>\r\n\r\n            <section className={styles.section}>\r\n                <h2>Existing Events</h2>\r\n                {loadingEvents ? (\r\n                    <p>Loading events...</p>\r\n                ) : events.length > 0 ? (\r\n                    <div className={styles.eventsGrid}>\r\n                        {events.map(event => {\r\n                            const images = eventImages[event.id] || [];\r\n                            return (\r\n                                <div \r\n                                    key={event.id} \r\n                                    className={`${styles.eventCard} ${deleting === event.id ? styles.deletingItem : ''}`}\r\n                                    onClick={() => navigate(`/admin/${event.id}`)}\r\n                                    onKeyDown={(e) => {\r\n                                        if (e.key === 'Enter' || e.key === ' ') {\r\n                                            e.preventDefault();\r\n                                            navigate(`/admin/${event.id}`);\r\n                                        }\r\n                                    }}\r\n                                    role=\"button\"\r\n                                    tabIndex={0}\r\n                                    aria-label={`View event: ${event.name}`}\r\n                                >\r\n                                    <div className={styles.eventHeader}>\r\n                                        <h3>{event.name}</h3>\r\n                                        <div className={styles.eventActions}>\r\n                                            <button\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    window.open(`/results/${event.id}`, '_blank');\r\n                                                }}\r\n                                                className={styles.resultsButton}\r\n                                            >\r\n                                                See Results\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    handleDeleteClick(event.id);\r\n                                                }}\r\n                                                className={`${styles.deleteButton} ${deleting === event.id ? styles.deleting : ''}`}\r\n                                                disabled={deleting === event.id}\r\n                                            >\r\n                                                <span className={styles.buttonText} style={{ opacity: deleting === event.id ? 0 : 1 }}>\r\n                                                    Delete\r\n                                                </span>\r\n                                                {deleting === event.id && (\r\n                                                    <span className={styles.spinner} />\r\n                                                )}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                    {images.length > 0 ? (\r\n                                        <div className={styles.imageCarousel}>\r\n                                            {images.map((imageUrl, index) => {\r\n                                                // Create a stable key from URL hash\r\n                                                const urlHash = imageUrl.split('/').pop() || imageUrl.slice(-30);\r\n                                                return (\r\n                                                <img \r\n                                                    key={`${event.id}-${urlHash}`} \r\n                                                    src={imageUrl} \r\n                                                    alt={`${event.name} - ${index + 1}`}\r\n                                                    className={styles.carouselImage}\r\n                                                />\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className={styles.noImages}>No images yet</div>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                ) : (\r\n                    <p>No events found.</p>\r\n                )}\r\n            </section>\r\n\r\n            {confirmDelete && (\r\n                <div \r\n                    className={styles.modalOverlay} \r\n                    onClick={handleDeleteCancel}\r\n                    onKeyDown={(e) => {\r\n                        if (e.key === 'Enter' || e.key === ' ' || e.key === 'Escape') {\r\n                            e.preventDefault();\r\n                            handleDeleteCancel();\r\n                        }\r\n                    }}\r\n                    role=\"button\"\r\n                    tabIndex={0}\r\n                    aria-label=\"Close delete confirmation\"\r\n                >\r\n                    <div \r\n                        className={styles.modal} \r\n                        onClick={(e) => e.stopPropagation()}\r\n                        role=\"dialog\"\r\n                        aria-modal=\"true\"\r\n                        onKeyDown={(e) => {\r\n                            if (e.key === 'Escape') {\r\n                                e.stopPropagation();\r\n                                handleDeleteCancel();\r\n                            }\r\n                        }}\r\n                    >\r\n                        <h3>Delete Event</h3>\r\n                        <p>Are you sure you want to delete this event and all its data? This action cannot be undone.</p>\r\n                        <div className={styles.modalActions}>\r\n                            <button \r\n                                onClick={handleDeleteCancel} \r\n                                className={styles.modalButton}\r\n                                disabled={deleting === confirmDelete}\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button \r\n                                onClick={handleDeleteConfirm} \r\n                                className={styles.modalDeleteButton}\r\n                                disabled={deleting === confirmDelete}\r\n                            >\r\n                                {deleting === confirmDelete ? 'Deleting...' : 'Delete'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\CookieDetectionDebug.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\CookieDetectionTest.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'runAllTests'. Either include it or remove the dependency array.","line":116,"column":6,"nodeType":"ArrayExpression","endLine":116,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [runAllTests]","fix":{"range":[4073,4075],"text":"[runAllTests]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\CookieDetectionVisualizer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\Home.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\Home.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nimport { AuthButton } from '../components/atoms/AuthButton/AuthButton';\r\nimport { useAuth } from '../lib/hooks/useAuth';\r\nimport styles from './Home.module.css';\r\n\r\nexport default function Home() {\r\n    const navigate = useNavigate();\r\n    const { user, loading, signIn, signOut } = useAuth();\r\n\r\n    useEffect(() => {\r\n        // Check if user is already signed in\r\n        if (!loading && user) {\r\n            // Check if user is signed in\r\n            const isSignedIn = user && (\r\n                user.email || \r\n                (user.providerData && user.providerData.length > 0)\r\n            );\r\n            \r\n            if (isSignedIn) {\r\n                // User is signed in, redirect to admin page\r\n                navigate('/admin', { replace: true });\r\n            }\r\n        }\r\n    }, [user, loading, navigate]);\r\n\r\n\r\n    return (\r\n        <div className={styles.landingContainer}>\r\n            <div className={styles.snowContainer}>\r\n                {Array.from({ length: 50 }, (_, i) => (\r\n                    <div key={`snowflake-${i}`} className={styles.snowflake} style={{\r\n                        left: `${Math.random() * 100}%`,\r\n                        animationDelay: `${Math.random() * 3}s`,\r\n                        animationDuration: `${3 + Math.random() * 4}s`,\r\n                        opacity: Math.random() * 0.5 + 0.5\r\n                    }}>❄</div>\r\n                ))}\r\n            </div>\r\n            <div className={styles.landingContent}>\r\n                <h1 className={styles.title}>\r\n                    <span className={styles.cookieEmoji}>🍪</span>\r\n                    Cookie Voting\r\n                </h1>\r\n                <p className={styles.subtitle}>Cast your vote for the best cookies!</p>\r\n                <div className={styles.authSection}>\r\n                    <p className={styles.authPrompt}>Administrators, sign in to manage events:</p>\r\n                    <AuthButton \r\n                        user={user}\r\n                        loading={loading}\r\n                        onSignIn={signIn}\r\n                        onSignOut={signOut}\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\ImageDetectionAudit.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\ResultsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\VotingPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\pages\\WizardPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\stories\\Button.stories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\stories\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\stories\\Header.stories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\stories\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\stories\\Page.stories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\src\\stories\\Page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\tywho\\OneDrive\\Documents\\Development\\GitHub\\CookieVoting\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
