---
trigger: model_decision
description: Zustand state management patterns and best practices.
generatedAt: "2025-12-24T21:01:01Z"
sourceChecksum: "cf5a4f9fe572"
---

> ⚠️ **AUTO-GENERATED** — Do not edit this file. Edit `ai/rules/zustand-patterns.md` instead.


# Zustand Patterns

## Store Structure

**Keep stores focused and small:**

```typescript
interface AuthStore {
  user: User | null;
  isLoading: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
}

export const useAuthStore = create<AuthStore>((set) => ({
  user: null,
  isLoading: true,
  signIn: async (email, password) => {
    set({ isLoading: true });
    const user = await authService.signIn(email, password);
    set({ user, isLoading: false });
  },
  signOut: async () => {
    await authService.signOut();
    set({ user: null });
  },
}));
```

## Selectors

**Use selectors to prevent unnecessary re-renders:**

```typescript
// ❌ Bad - component re-renders on ANY store change
function UserProfile() {
  const store = useAuthStore();
  return <div>{store.user?.name}</div>;
}

// ✅ Good - only re-renders when user changes
function UserProfile() {
  const user = useAuthStore((state) => state.user);
  return <div>{user?.name}</div>;
}

// ✅ Good - select multiple values
function AuthStatus() {
  const { user, isLoading } = useAuthStore(
    (state) => ({ user: state.user, isLoading: state.isLoading })
  );
}
```

## Async Actions

**Handle loading and error states:**

```typescript
interface EventStore {
  events: Event[];
  isLoading: boolean;
  error: string | null;
  fetchEvents: () => Promise<void>;
}

export const useEventStore = create<EventStore>((set) => ({
  events: [],
  isLoading: false,
  error: null,
  fetchEvents: async () => {
    set({ isLoading: true, error: null });
    try {
      const events = await eventService.getAll();
      set({ events, isLoading: false });
    } catch (error) {
      set({ error: 'Failed to load events', isLoading: false });
    }
  },
}));
```

## Store Organization

```
src/lib/stores/
├── useAuthStore.ts      # Authentication state
├── useEventStore.ts     # Event data
├── useBakerStore.ts     # Baker data
└── useUIStore.ts        # UI state (modals, toasts)
```

## When to Use Zustand vs Local State

| Use Case | Solution |
|----------|----------|
| Form input values | `useState` |
| Modal open/closed | `useState` |
| Current user | Zustand |
| Shared data across routes | Zustand |
| Server cache | Zustand or React Query |

## Zustand Checklist

- [ ] Stores are focused (single responsibility)
- [ ] Selectors used to prevent unnecessary re-renders
- [ ] Loading and error states handled in async actions
- [ ] Store actions handle their own errors
